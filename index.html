<!-- index.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mon Histoire</title>
  <link href="style.css" rel="stylesheet"/>
</head>
<body>
  <!-- Accueil -->
  <section class="screen active" id="accueil">
    <div class="bloc-centre" id="accueil-content">
      <h1>Mon Histoire</h1>
      <button class="button" id="create-button" onclick="showScreen('formulaire')">
        Créer une histoire
      </button>
      <button class="button hidden" id="login-button" onclick="showScreen('connexion')">
        Me connecter
      </button>
      <button class="button hidden" id="my-stories-button" onclick="showScreen('mes-histoires')">
        Mes Histoires
      </button>
    </div>
    <div id="user-icon" class="hidden" onclick="document.getElementById('logout-modal').style.display='flex'">
      GM
    </div>
  </section>

  <!-- Modal de déconnexion -->
<div class="logout-modal" id="logout-modal">
  <div class="bloc-centre">
    <p>Voulez-vous vous déconnecter ?</p>
    <button class="button" onclick="logoutUser()">Se déconnecter</button>
    <button class="button" onclick="document.getElementById('logout-modal').style.display='none'">
      Annuler
    </button>
    <button class="button" style="background:#e74c3c; color:#fff; margin-top:1rem;" onclick="openDeleteAccountModal()">Supprimer mon compte</button>
  </div>
</div>


  <!-- Connexion -->
  <section class="screen" id="connexion">
    <div class="bloc-centre">
      <h2>Connexion</h2>
     <form onsubmit="event.preventDefault(); loginUser();" autocomplete="off">
         <input class="input-style" id="email" placeholder="Adresse email" required type="email" autocomplete="off"/>
         <input class="input-style" id="password" placeholder="Mot de passe" required type="password" autocomplete="new-password"/>
      <div class="button-group">
    <button class="button" type="submit">Se connecter</button>
    <button class="button" type="button" onclick="showScreen('accueil')">Annuler</button>
  </div>
</form>
      <p style="text-align:center;">
        <button class="button small" onclick="toggleSignup(true)" type="button">Créer un compte</button><br/>
        <a href="#" onclick="toggleReset(true)" style="font-size:0.9rem; display:inline-block; margin-top:0.5rem;">Mot de passe oublié ?</a>
      </p>
      <div class="bloc-centre" id="signup-form" style="display:none;">
        <h2>Créer un compte</h2>
        <input class="input-style" id="prenom" placeholder="Prénom" required type="text" autocomplete="off"/>
        <input class="input-style" id="signup-email" placeholder="Adresse email" required type="email" autocomplete="off"/>
        <input class="input-style" id="signup-password" placeholder="Mot de passe" required type="password" autocomplete="new-password"/>
        <input class="input-style" id="signup-confirm" placeholder="Confirmer le mot de passe" required type="password" autocomplete="new-password"/>
        <div class="button-group">
    <button class="button" onclick="registerUser()">Valider</button>
    <button class="button" type="button" onclick="toggleSignup(false)">Annuler</button>
  </div>
</div>
      <div class="bloc-centre" id="reset-form" style="display:none;">
        <h2>Réinitialisation</h2>
        <input class="input-style" id="reset-email" placeholder="Votre adresse email" required type="email"/>
        <div class="button-group">
          <button class="button" onclick="sendReset()">Envoyer</button>
          <button class="button" type="button" onclick="toggleReset(false)">Annuler</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Formulaire de création -->
  <section class="screen" id="formulaire">
    <div class="bloc-centre">
      <h2>Créer une Histoire</h2>
      <form onsubmit="event.preventDefault(); genererHistoire();">
        <input class="input-style" id="nom" placeholder="Nom du héros" required type="text"/>
        <select class="input-style" id="personnage">
          <option value="chevalier">Chevalier</option>
          <option value="princesse">Princesse</option>
          <option value="fée">Fée</option>
          <option value="explorateur">Explorateur</option>
        </select>
        <select class="input-style" id="lieu">
          <option value="forêt enchantée">Forêt enchantée</option>
          <option value="château">Château</option>
          <option value="plaine magique">Plaine magique</option>
          <option value="volcan endormi">Volcan endormi</option>
        </select>
        <select class="input-style" id="objet">
          <option value="baguette">Baguette</option>
          <option value="épée">Épée</option>
          <option value="livre magique">Livre magique</option>
          <option value="amulette">Amulette</option>
        </select>
        <select class="input-style" id="compagnon">
          <option value="dragon">Dragon</option>
          <option value="licorne">Licorne</option>
          <option value="chat parlant">Chat parlant</option>
          <option value="">Aucun</option>
        </select>
        <select class="input-style" id="mission">
          <option value="sauver un village">Sauver un village</option>
          <option value="découvrir un trésor">Découvrir un trésor</option>
          <option value="réparer la nature">Réparer la nature</option>
          <option value="retrouver un ami perdu">Retrouver un ami perdu</option>
        </select>
        <select class="input-style" id="style">
          <option value="drôle">Drôle</option>
          <option value="poétique">Poétique</option>
          <option value="suspense">Suspense</option>
          <option value="personnalisé">Personnalisé</option>
        </select>
        <select class="input-style" id="duree">
          <option value="courte">Courte</option>
          <option value="moyenne">Moyenne</option>
          <option value="longue">Longue</option>
        </select>
        <div class="form-buttons">
          <button class="button" type="submit">Générer</button>
          <button class="button" type="button" onclick="showScreen('accueil')">Annuler</button>
        </div>
      </form>
    </div>
  </section>

  <!-- Résultat -->
  <section class="screen" id="resultat">
    <div class="bloc-centre">
      <h2>Ton Histoire</h2>
      <div id="histoire"></div>
     <div class="actions-resultat">
      <button class="button" onclick="retourDepuisResultat()">Retour</button>
      <button class="button" onclick="showScreen('accueil')">Accueil</button>
      <button id="btn-sauvegarde" class="button" onclick="demanderSauvegarde()">Sauvegarder</button>
      </div>
    </div>
  </section>

  <div id="modal-limite" class="modal">
    <div class="modal-content">
      <p>Plus de place pour sauvegarder. Voulez-vous supprimer des histoires ?</p>
      <div class="button-group">
        <button class="button" onclick="fermerModaleLimite()">Non</button>
        <button class="button" onclick="validerModaleLimite()">Oui</button>
      </div>
    </div>
  </div>

  <div class="modal" id="delete-modal">
    <div class="modal-content">
      <p>Supprimer les histoires sélectionnées ?</p>
      <div class="button-group">
        <button class="button" onclick="confirmDelete()">Oui</button>
        <button class="button" onclick="closeDeleteModal()">Non</button>
      </div>
    </div>
  </div>

  <!-- Mes Histoires -->
<!-- Mes Histoires -->
<section class="screen" id="mes-histoires">
  <div class="bloc-centre">
    <h2 style="display: flex; align-items: center; justify-content: space-between;">
  Mes Histoires
  <span id="compteur-histoires" style="margin-left:1rem; font-size:1.1rem;"></span>
</h2>
   <ul id="liste-histoires"></ul>
    <div class="actions-footer" id="barre-suppression" style="display:none;">
      <img
        src="corbeille-cartoon.png"
        alt="Corbeille"
        id="btn-corbeille"
        onclick="supprimerHistoiresSelectionnees()"
      >
      <img
        src="croix-cartoon.png"
        alt="Annuler sélection"
        id="btn-annuler-selection"
        onclick="reinitialiserSelectionHistoires()"
      >
    </div>
    <!-- Bloc à insérer à la place du simple bouton -->
<div class="form-buttons" id="mes-histoires-actions">
  <button class="button" id="btn-retour-mes-histoires" onclick="goBack()">Retour</button>
  <button class="button" id="btn-accueil-mes-histoires" onclick="showScreen('accueil')" style="display:none;">Accueil</button>
</div>

  </div>
</section>


  <!-- ====== CI-DESSOUS : SCRIPTS FIREBASE (pas de type=module, pas d'import/export) ====== -->
<!-- Firebase SDK compatibilité navigateur -->
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-analytics-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB9cbe7d67gAEMSSV0EnZDe1ocaHO8dzqs",
    authDomain: "mon-histoire-9ea8b.firebaseapp.com",
    projectId: "mon-histoire-9ea8b",
    storageBucket: "mon-histoire-9ea8b.appspot.com",
    messagingSenderId: "161346258517",
    appId: "1:161346258517:web:6844de025dff1173f2f6dc",
    measurementId: "G-SFPQGT4D5M"
  };
  firebase.initializeApp(firebaseConfig);
  if ('measurementId' in firebaseConfig) {
    firebase.analytics();
  }
</script>
<script src="app.js" defer></script>


  <!-- Modal générique pour messages -->
<div id="message-modal" class="modal">
  <div class="message-card">
    <p id="message-modal-text"></p>
    <button class="button" onclick="closeMessageModal()">OK</button>
  </div>
</div>


<div class="modal" id="delete-account-modal">
  <div class="message-card">
    <p style="color:#e74c3c; font-weight:bold;">
      Action irréversible.<br>Toutes vos données seront supprimées.<br>Êtes-vous sûr ?
    </p>
    <button class="button" style="background:#e74c3c; color:#fff;" onclick="deleteAccount()">Oui, supprimer mon compte</button>
    <button class="button" onclick="closeDeleteAccountModal()">Annuler</button>
  </div>
</div>
  
</body>
</html>
